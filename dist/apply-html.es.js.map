{"version":3,"file":"apply-html.es.js","sources":["../src/index.js"],"sourcesContent":["import nanomorph from 'nanomorph';\n\nexport class SafeString {\n\tconstructor(raw) {\n\t\tthis.raw = String(raw);\n\t}\n\n\tget length() {\n\t\treturn this.raw.length;\n\t}\n\n\ttoJSON() {\n\t\treturn this.raw;\n\t}\n\n\ttoString() {\n\t\treturn this.raw;\n\t}\n}\n\nexport function escape(value) {\n\tif (typeof value !== 'string') {\n\t\tthrow new TypeError('Expected a string.');\n\t}\n\n\treturn value\n\t\t.replace(/&/g, '&amp;')\n\t\t.replace(/>/g, '&gt;')\n\t\t.replace(/</g, '&lt;')\n\t\t.replace(/\"/g, '&quot;')\n\t\t.replace(/'/g, '&#39;')\n\t\t.replace(/`/g, '&#96;');\n}\n\nexport function serialize(value) {\n\tif (value instanceof SafeString) {\n\t\t// Assume trustworthy\n\t\treturn value.raw;\n\t}\n\n\tif (Array.isArray(value)) {\n\t\treturn value.map(serialize).join('');\n\t}\n\n\tif (value === null || value === undefined) {\n\t\treturn '';\n\t}\n\n\tswitch (typeof value) {\n\t\tcase 'boolean':\n\t\t\treturn '';\n\n\t\tcase 'function':\n\t\t\tthrow new TypeError(`Unexpected function: ${value}`);\n\n\t\tcase 'number':\n\t\t\tvalue = String(value);\n\t\t\tbreak;\n\n\t\tcase 'object':\n\t\t\tvalue = JSON.stringify(value);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\n\t// Assume untrustworthy\n\treturn escape(value);\n}\n\nexport function apply(element, string) {\n\tif (!(element instanceof Element)) {\n\t\tthrow new TypeError('Expected an element.');\n\t}\n\n\tif (string instanceof SafeString) {\n\t\tstring = string.toString();\n\t}\n\n\tif (typeof string !== 'string') {\n\t\tthrow new TypeError('Expected a string.');\n\t}\n\n\tconst template = document.createElement('template');\n\n\t// Create inert DOM structure for diffing. Prevents\n\t// premature or duplicate resource loading and\n\t// execution of custom-element lifecycle callbacks.\n\ttemplate.innerHTML = string;\n\n\t// Patch live DOM with new inert DOM\n\tnanomorph(element, template.content, {\n\t\tchildrenOnly: true,\n\t});\n\n\treturn element;\n}\n\nexport function html(strings, ...values) {\n\tconst literals = strings.raw;\n\tlet result = '';\n\n\tvalues.forEach((value, i) => {\n\t\tresult += literals[i];\n\t\tresult += serialize(value);\n\t});\n\n\tresult += literals[literals.length - 1];\n\n\treturn new SafeString(result);\n}\n\nexport function raw(string) {\n\tif (string instanceof SafeString) {\n\t\treturn string;\n\t}\n\n\treturn new SafeString(string);\n}\n"],"names":[],"mappings":"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"}